{"ast":null,"code":"import { LOAD_ITEMS, REMOVE_ITEM, ADD_ITEM } from './items';\nimport { ValidationError } from '../utils/validationError';\nconst LOAD = 'pokemon/LOAD';\nconst LOAD_TYPES = 'pokemon/LOAD_TYPES';\nconst ADD_ONE = 'pokemon/ADD_ONE';\n\nconst load = list => ({\n  type: LOAD,\n  list\n});\n\nconst loadTypes = types => ({\n  type: LOAD_TYPES,\n  types\n});\n\nconst addOnePokemon = pokemon => ({\n  type: ADD_ONE,\n  pokemon\n});\n\nexport const getPokemon = () => async dispatch => {\n  const response = await fetch(`/api/pokemon`);\n\n  if (response.ok) {\n    const list = await response.json();\n    dispatch(load(list));\n  }\n};\nexport const getPokemonTypes = () => async dispatch => {\n  const response = await fetch(`/api/pokemon/types`);\n\n  if (response.ok) {\n    const types = await response.json();\n    dispatch(loadTypes(types));\n  }\n};\nexport const getOnePokemon = id => async dispatch => {\n  const response = await fetch(`/api/pokemon/${id}`);\n\n  if (response.ok) {\n    const pokemon = await response.json();\n    dispatch(addOnePokemon(pokemon));\n  }\n};\nexport const createPokemon = data => async dispatch => {\n  try {\n    const response = await fetch(`/api/pokemon`, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    });\n\n    if (!response.ok) {\n      let error;\n\n      if (response.status === 422) {\n        error = await response.json();\n        throw new ValidationError(error.errors, response.statusText);\n      } else {\n        let errorJSON;\n        error = await response.text();\n\n        try {\n          // Check if the error is JSON, i.e., from the Pokemon server. If so,\n          // don't throw error yet or it will be caught by the following catch\n          errorJSON = JSON.parse(error);\n        } catch {\n          // Case if server could not be reached\n          throw new Error(error);\n        }\n\n        throw new Error(`${errorJSON.title}: ${errorJSON.message}`);\n      }\n    }\n\n    const pokemon = await response.json();\n    dispatch(addOnePokemon(pokemon));\n    return pokemon;\n  } catch (error) {\n    throw error;\n  }\n};\nexport const updatePokemon = data => async dispatch => {\n  const response = await fetch(`/api/pokemon/${data.id}`, {\n    method: 'put',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(data)\n  });\n\n  if (response.ok) {\n    const pokemon = await response.json();\n    dispatch(addOnePokemon(pokemon));\n    return pokemon;\n  }\n};\nconst initialState = {\n  list: [],\n  types: []\n};\n\nconst sortList = list => {\n  return list.sort((pokemonA, pokemonB) => {\n    return pokemonA.number - pokemonB.number;\n  }).map(pokemon => pokemon.id);\n};\n\nconst pokemonReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case LOAD:\n      const allPokemon = {};\n      action.list.forEach(pokemon => {\n        allPokemon[pokemon.id] = pokemon;\n      });\n      return { ...allPokemon,\n        ...state,\n        list: sortList(action.list)\n      };\n\n    case LOAD_TYPES:\n      return { ...state,\n        types: action.types\n      };\n\n    case ADD_ONE:\n      if (!state[action.pokemon.id]) {\n        const newState = { ...state,\n          [action.pokemon.id]: action.pokemon\n        };\n        const pokemonList = newState.list.map(id => newState[id]);\n        pokemonList.push(action.pokemon);\n        newState.list = sortList(pokemonList);\n        return newState;\n      }\n\n      return { ...state,\n        [action.pokemon.id]: { ...state[action.pokemon.id],\n          ...action.pokemon\n        }\n      };\n\n    case LOAD_ITEMS:\n      return { ...state,\n        [action.pokemonId]: { ...state[action.pokemonId],\n          items: action.items.map(item => item.id)\n        }\n      };\n\n    case REMOVE_ITEM:\n      return { ...state,\n        [action.pokemonId]: { ...state[action.pokemonId],\n          items: state[action.pokemonId].items.filter(itemId => itemId !== action.itemId)\n        }\n      };\n\n    case ADD_ITEM:\n      console.log(action.item);\n      return { ...state,\n        [action.item.pokemonId]: { ...state[action.item.pokemonId],\n          items: [...state[action.item.pokemonId].items, action.item.id]\n        }\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport default pokemonReducer;","map":{"version":3,"sources":["/Users/alan/Downloads/practice-for-week-15-react-thunk-pokedex-long-practice/src/store/pokemon.js"],"names":["LOAD_ITEMS","REMOVE_ITEM","ADD_ITEM","ValidationError","LOAD","LOAD_TYPES","ADD_ONE","load","list","type","loadTypes","types","addOnePokemon","pokemon","getPokemon","dispatch","response","fetch","ok","json","getPokemonTypes","getOnePokemon","id","createPokemon","data","method","headers","body","JSON","stringify","error","status","errors","statusText","errorJSON","text","parse","Error","title","message","updatePokemon","initialState","sortList","sort","pokemonA","pokemonB","number","map","pokemonReducer","state","action","allPokemon","forEach","newState","pokemonList","push","pokemonId","items","item","filter","itemId","console","log"],"mappings":"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","sourcesContent":["import { LOAD_ITEMS, REMOVE_ITEM, ADD_ITEM } from './items';\nimport { ValidationError } from '../utils/validationError';\n\nconst LOAD = 'pokemon/LOAD';\nconst LOAD_TYPES = 'pokemon/LOAD_TYPES';\nconst ADD_ONE = 'pokemon/ADD_ONE';\n\nconst load = list => ({\n  type: LOAD,\n  list\n});\n\nconst loadTypes = types => ({\n  type: LOAD_TYPES,\n  types\n});\n\nconst addOnePokemon = pokemon => ({\n  type: ADD_ONE,\n  pokemon\n});\n\nexport const getPokemon = () => async dispatch => {\n  const response = await fetch(`/api/pokemon`);\n\n  if (response.ok) {\n    const list = await response.json();\n    dispatch(load(list));\n  }\n};\n\nexport const getPokemonTypes = () => async dispatch => {\n  const response = await fetch(`/api/pokemon/types`);\n\n  if (response.ok) {\n    const types = await response.json();\n    dispatch(loadTypes(types));\n  }\n};\n\nexport const getOnePokemon = id => async dispatch => {\n  const response = await fetch(`/api/pokemon/${id}`);\n\n  if (response.ok) {\n    const pokemon = await response.json();\n    dispatch(addOnePokemon(pokemon));\n  }\n};\n\nexport const createPokemon = data => async dispatch => {\n  try {\n    const response = await fetch(`/api/pokemon`, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    });\n\n    if (!response.ok) {\n      let error;\n      if (response.status === 422) {\n        error = await response.json();\n        throw new ValidationError(error.errors, response.statusText);\n      } \n      else {\n        let errorJSON;\n        error = await response.text();\n        try {\n          // Check if the error is JSON, i.e., from the Pokemon server. If so,\n          // don't throw error yet or it will be caught by the following catch\n          errorJSON = JSON.parse(error);\n        }\n        catch {\n          // Case if server could not be reached\n          throw new Error(error);\n        }\n        throw new Error(`${errorJSON.title}: ${errorJSON.message}`);\n      }\n    } \n\n    const pokemon = await response.json();\n    dispatch(addOnePokemon(pokemon));\n    return pokemon;\n  } \n  catch (error) {\n    throw error;\n  }\n};\n\nexport const updatePokemon = data => async dispatch => {\n  const response = await fetch(`/api/pokemon/${data.id}`, {\n    method: 'put',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(data)\n  });\n  \n  if (response.ok) {\n    const pokemon = await response.json();\n    dispatch(addOnePokemon(pokemon));\n    return pokemon;\n  }\n};\n\nconst initialState = {\n  list: [],\n  types: []\n};\n\nconst sortList = (list) => {\n  return list.sort((pokemonA, pokemonB) => {\n    return pokemonA.number - pokemonB.number;\n  }).map((pokemon) => pokemon.id);\n};\n\nconst pokemonReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case LOAD: \n      const allPokemon = {};\n      action.list.forEach(pokemon => {\n        allPokemon[pokemon.id] = pokemon;\n      });\n      return {\n        ...allPokemon,\n        ...state,\n        list: sortList(action.list)\n      };\n    case LOAD_TYPES: \n      return {\n        ...state,\n        types: action.types\n      };\n    case ADD_ONE: \n      if (!state[action.pokemon.id]) {\n        const newState = {\n          ...state,\n          [action.pokemon.id]: action.pokemon\n        };\n        const pokemonList = newState.list.map(id => newState[id]);\n        pokemonList.push(action.pokemon);\n        newState.list = sortList(pokemonList);\n        return newState;\n      }\n      return {\n        ...state,\n        [action.pokemon.id]: {\n          ...state[action.pokemon.id],\n          ...action.pokemon\n        }\n      };\n    case LOAD_ITEMS: \n      return {\n        ...state,\n        [action.pokemonId]: {\n          ...state[action.pokemonId],\n          items: action.items.map(item => item.id)\n        }\n      };\n    case REMOVE_ITEM:\n      return {\n        ...state,\n        [action.pokemonId]: {\n          ...state[action.pokemonId],\n          items: state[action.pokemonId].items.filter(\n            (itemId) => itemId !== action.itemId\n          )\n        }\n      };\n    case ADD_ITEM:\n      console.log(action.item);\n      return {\n        ...state,\n        [action.item.pokemonId]: {\n          ...state[action.item.pokemonId],\n          items: [...state[action.item.pokemonId].items, action.item.id]\n        }\n      };\n    default:\n      return state;\n  }\n}\n\nexport default pokemonReducer;"]},"metadata":{},"sourceType":"module"}